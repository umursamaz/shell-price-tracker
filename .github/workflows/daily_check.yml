name: Daily Price Check

on:
  schedule:
    # Her gün saat 21:00 UTC = 00:00 Türkiye saati
    - cron: '0 21 * * *'
  
  # Manuel çalıştırma için
  workflow_dispatch:

jobs:
  check-price:
    runs-on: ubuntu-latest
    
    steps:
      - name: 📥 Kodu çek
        uses: actions/checkout@v3
      
      - name: 🐍 Python kur
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: 🌐 Chrome kur
        run: |
          sudo apt-get update
          sudo apt-get install -y chromium-browser chromium-chromedriver
      
      - name: 📦 Python paketlerini yükle
        run: |
          pip install selenium
      
      - name: 📂 Geçmiş verileri yükle
        uses: actions/download-artifact@v3
        with:
          name: fiyat-verileri
        continue-on-error: true
      
      - name: 🚀 Scripti çalıştır
        env:
          SMTP_KEY: ${{ secrets.SMTP_KEY }}
          EMAIL_SENDER: ${{ secrets.EMAIL_SENDER }}
          EMAIL_RECEIVER: ${{ secrets.EMAIL_RECEIVER }}
        run: python3 yakit_fiyat_takip.py
      
      - name: 💾 Verileri kaydet
        uses: actions/upload-artifact@v3
        with:
          name: fiyat-verileri
          path: fiyat_verileri.json
          retention-days: 365
      
      - name: 📤 Repo'ya commit (opsiyonel)
        run: |
          git config user.name "GitHub Actions Bot"
          git config user.email "actions@github.com"
          git add fiyat_verileri.json
          git diff --quiet && git diff --staged --quiet || git commit -m "📊 Fiyat güncellendi: $(date '+%Y-%m-%d %H:%M')"
          git push
        continue-on-error: true
