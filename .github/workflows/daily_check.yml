name: Daily Price Check

on:
  schedule:
    # Her gÃ¼n saat 21:00 UTC = 00:00 TÃ¼rkiye saati
    - cron: '0 21 * * *'
  
  # Manuel Ã§alÄ±ÅŸtÄ±rma iÃ§in
  workflow_dispatch:

jobs:
  check-price:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Kodu Ã§ek
        uses: actions/checkout@v3
      
      - name: ğŸ Python kur
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: ğŸŒ Chrome kur
        run: |
          sudo apt-get update
          sudo apt-get install -y chromium-browser chromium-chromedriver
      
      - name: ğŸ“¦ Python paketlerini yÃ¼kle
        run: |
          pip install selenium
      
      - name: ğŸ“‚ GeÃ§miÅŸ verileri yÃ¼kle
        uses: actions/download-artifact@v3
        with:
          name: fiyat-verileri
        continue-on-error: true
      
      - name: ğŸš€ Scripti Ã§alÄ±ÅŸtÄ±r
        env:
          SMTP_KEY: ${{ secrets.SMTP_KEY }}
          EMAIL_SENDER: ${{ secrets.EMAIL_SENDER }}
          EMAIL_RECEIVER: ${{ secrets.EMAIL_RECEIVER }}
        run: python3 yakit_fiyat_takip.py
      
      - name: ğŸ’¾ Verileri kaydet
        uses: actions/upload-artifact@v3
        with:
          name: fiyat-verileri
          path: fiyat_verileri.json
          retention-days: 365
      
      - name: ğŸ“¤ Repo'ya commit (opsiyonel)
        run: |
          git config user.name "GitHub Actions Bot"
          git config user.email "actions@github.com"
          git add fiyat_verileri.json
          git diff --quiet && git diff --staged --quiet || git commit -m "ğŸ“Š Fiyat gÃ¼ncellendi: $(date '+%Y-%m-%d %H:%M')"
          git push
        continue-on-error: true
